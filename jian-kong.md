## 监控

| AWS | PEST |
| :--- | :--- |
| [Amazon CloudWatch](amazon-cloudwatch.md) 是AWS提供的监控服务，该服务集成到了[AWS CodeBuild](aws-codebuild.md)里，在 Code Build控制台可以看到构建任务的指标，以及构建日志信息。 | PSET的监控分两部分一个是Monitor对PSET各个模块本身的监控，一个是集成到了MAM能够监控构建日志信息，和应用构建的健康状况、构建数量等指标。 |

# AWS
AWS的监控是AWS CloudWatch提供服务，下图是监控的控制面板，菜单栏分了CloudWatch、控制面板、警报、事件按、日志、指标四个菜单、除了CloudWatch和控制面板外每个菜单下有各自的子菜单。
![](/assets/2019-02-22_105616.png)
## CloudWatch
Cloud Watch是一个监控仪表盘，汇总了许多监控的信息，AWS服务状态以及不同服务提供的信息、警报信息、日志信息、构建成功或者失败的信息、CPU负载和IO信息。
![](/assets/2019-02-22_110007.png)

同时在每个服务都有自己的控制面板，如下是日志存储的控制面板信息
![](/assets/2019-02-22_112654.png)

如下是CodeBuild的控制面板信息
![](/assets/2019-02-22_112758.png)

如下是EC2的控制面板信息。
![](/assets/2019-02-22_112445.png)

如下是查看EBS服务的控制面板，展现的信息更多。
![](/assets/2019-02-22_112128.png)

如下是S3的控制面板信息
![](/assets/2019-02-22_112411.png)

## 控制面板
AWS用户可以根据自己的需要创建控制面板
![](/assets/2019-02-22_113032.png)

输入控制面板名称后，选择添加小部件。
![](/assets/2019-02-22_113145.png)

然后在选择监控的指标。
![](/assets/2019-02-22_113427.png)

如此一个用户自定义的监控面板创建好了。
![](/assets/2019-02-22_115932.png)

## 警报
用户可以创建一个 CloudWatch 警报来监视单个 CloudWatch 指标，或基于 CloudWatch 指标监视数学表达式的结果。警报根据指标或表达式在多个时间段内相对于某阈值的值执行一项或多项操作。该操作可以是 Amazon EC2 操作、Amazon EC2 Auto Scaling 操作或发送到 Amazon SNS 主题的通知，大白话就是你对某个指标设置了警告，当指标达到阀值就会给你发邮件。

您也可以向 CloudWatch 控制面板添加警报，并以可视化方式监控它们。当某个警报位于控制面板上时，如果它处于 ALARM 状态，则会变成红色，便于您主动监控其状态。

警报仅在出现持续状态变化时才会调用操作。CloudWatch 警报将不会仅因为其处于特定状态而调用操作；该状态必须已改变并在指定的若干个时间段内保持不变。

因为状态改变而导致警报调用操作后，其后续行为取决于您关联到警报的操作类型。对于 Amazon EC2 Auto Scaling 操作，警报会在警报保持新状态的每个时间段中继续调用操作。对于 Amazon SNS 通知，不会调用额外操作。
![](/assets/2019-02-22_120242.png)

创建警报，所需要填写的信息。需要说明的是AutoScaling操作，该操作适用于如果你的某个应用计算资源枯竭或者访问的流量剧增可以自动扩容。
![](/assets/2019-02-22_120418.png)

## 事件
CloudWatch事件能够监控AWS各个服务状态的改变，目前AWS Watch能够探测到的事件如下：
![](/assets/2019-02-22_154655.png)

创建为事件创建规则，当探测到某个事件发生时，会触发一个目标，例如：当用户提交源码后自动触发构建，创建一个事件规则，如下所示
![](/assets/2019-02-22_155034.png)

AWS可以通过事件总线把你创建的事件共享给其他AWS用户/组织，点击添加权限，输入账户ID或者组织ID即可。
![](/assets/2019-02-22_155259.png)

# 日志
用户可以使用 Amazon CloudWatch Logs 来监控、存储和访问来自 Amazon Elastic Compute Cloud (Amazon EC2) 实例、AWS CloudTrail、Route 53 和其他来源的日志文件。您随后可以从 CloudWatch Logs 中检索关联的日志数据。
![](/assets/2019-02-22_155819.png)

监控来自 Amazon EC2 实例的日志 — 您可以使用 CloudWatch Logs 通过日志数据监控应用程序和系统。例如，CloudWatch Logs 能够跟踪应用程序日志中的错误数，并在错误率超过指定阈值时向您发送通知。CloudWatch Logs 使用您的日志数据进行监控，因此无需更改代码。例如，您可以监控应用程序日志以查找特定字词（如“NullReferenceException”）或日志数据中特定位置处某个字词（如 Apache 访问日志中的“404”状态代码）出现的次数。找到您要搜索的字词时，CloudWatch Logs 向您指定的 CloudWatch 指标报告该数据。日志数据会在传输期间加密，并且会对静态日志数据加密。要了解其用法，请参阅 CloudWatch Logs 入门。

监控 AWS CloudTrail 记录的事件 — 您可以在 CloudWatch 中创建警报并接收 CloudTrail 捕获的特定 API 活动的通知，然后使用通知执行故障排除。要开始入门，请参阅 AWS CloudTrail User Guide 中的 将 CloudTrail 事件发送到 CloudWatch Logs。

日志保留 — 默认情况下，日志将无限期保留且永不过期。您可以调整每个日志组的保留策略，保持无限期保留或选择介于 10 年和一天之间的保留期。

归档日志数据 — 您可以使用 CloudWatch Logs 在高持久性存储中存储日志数据。CloudWatch Logs 代理支持您轻松快速地将已轮换和未轮换的日志文件从主机移动到日志服务。然后，您可以按需访问原始日志数据。

记录 Route 53 DNS 查询 — 您可以使用 CloudWatch Logs 记录有关 Route 53 收到的 DNS 查询的信息。有关更多信息。

# 指标
指标是关于您的系统性能的数据。默认情况下，许多服务都提供资源（例如，Amazon EC2 实例、Amazon EBS 卷和 Amazon RDS 数据库实例）的免费指标。您也可以启用对某些资源（如 Amazon EC2 实例）的详细监控，或发布自己的应用程序指标。Amazon CloudWatch 可加载您的账户中的所有指标（包括您提供的 AWS 资源指标和应用程序指标）以进行搜索、绘制图表及设置警报。

指标数据的保留期限为 15 个月，这使您能够查看最新数据和历史数据。

目前可以用的指标，如下所示
![](/assets/2019-02-22_161443.png)

用户根据指标可以指标的统计数据、周期、显示位置
![](/assets/2019-02-22_161801.png)

通过复制操作，笔者设置了以5分钟为一个周期的构建间隔的最大值和平均值
![](/assets/2019-02-22_162138.png)

用户可以配置指标的图标成习惯的阅读方式
![](/assets/2019-02-22_162406.png)

源这是一个脚本，用户根据这个脚本创建成和笔者一样的指标
![](/assets/2019-02-22_162622.png)

# 总结

1. PSET的监控仅仅是对各个模块的的磁盘空间和网络进行监控，但是缺少CPU、磁盘IO等、网络流量
、内存使用状态等信息。
2. PSET只有磁盘空间警报和网络不同警报，没有AWS丰富。
3. PSET目前只有一个自动触发构建和定时构建的事件，没有AWS丰富例如不具备源码状态监控事件，而且用户不能制定事件规则和共享事件。
4. PSET没有日志控制台，PSET的模块有很多但日志都是分散在各个服务器中，对用户开发的日志也较少，目前只有构建日志用户可以查看。
5. PSET的指标信息也没有AWS丰富，不具备用户可配置功能，下图是AWS发布指标的服务。
![](/assets/2019-02-22_163628.png)
